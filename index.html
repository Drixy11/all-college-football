<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Drixy College Football Schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background: #121212;
    color: #fff;
  }

  /* ====== NDSU PRIDE STRIPE HEADER ====== */
  .header {
    background: #004F23; /* NDSU Green */
    padding: 1.2rem 1.5rem 0.7rem;
    text-align: center;
    font-size: 1.8rem;
    font-weight: 700;
    position: relative;
  }
  .header::after {
    content: "";
    display: block;
    height: 10px;
    background: #FFC72A; /* NDSU Gold */
    width: 100%;
    margin-top: 0.4rem;
  }

  #status {
    text-align: center;
    padding: 0.6rem;
    font-size: 0.9rem;
    color: #f1f1f1;
    opacity: 0.9;
  }

  /* ======= TABLE ======= */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0.8rem;
    font-size: 0.9rem;
  }

  thead {
    background: #1c1c1c;
  }
  th {
    text-align: left;
    padding: 0.6rem 0.8rem;
    color: #FFC72A; /* Gold headers */
    font-weight: 600;
    border-bottom: 2px solid #004F23;
  }

  tr:nth-child(even) {
    background: #0E0E0E;
  }
  tr:nth-child(odd) {
    background: #050505;
  }

  td {
    padding: 0.6rem 0.8rem;
  }

  .division-pill {
    background: #FFC72A;
    color: #000;
    padding: 0.15rem 0.45rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 700;
  }

  .status-final { color: #22c55e; font-weight: 700; }
  .status-live { color: #ff7f50; font-weight: 700; }
  .status-scheduled { color: #ccc; }
</style>
</head>

<body>
<div class="header">College Football – Full Week Unified Schedule</div>
<div id="status">Loading current week…</div>

<table>
<thead>
  <tr>
    <th>Time</th>
    <th>Div</th>
    <th>Matchup</th>
    <th>TV</th>
    <th>Status</th>
  </tr>
</thead>
<tbody id="scheduleBody"></tbody>
</table>

<script>
/* ============================
   CONFIG
============================ */
const API_KEY = "CXUq4XiFsiIhzjVUJa7F4kGFAcUntHEuRp4qWzuhB3kJvoyEG6iqOb2f5zO0mq+0";  // <-- INSERT YOUR API KEY
const CFBD_BASE = "https://api.collegefootballdata.com";

/* ============================
   FETCH CURRENT WEEK
============================ */
async function getCurrentWeek() {
  const year = new Date().getFullYear();
  const url = `${CFBD_BASE}/calendar?year=${year}`;

  const res = await fetch(url, {
    headers: { "Authorization": `Bearer ${API_KEY}` }
  });

  if (!res.ok) throw new Error("Failed to load CFBD calendar");

  const data = await res.json();
  const today = new Date();

  // Find the week where today is between startDate and endDate
  const current = data.find(w => {
    const s = new Date(w.startDate);
    const e = new Date(w.endDate);
    return today >= s && today <= e;
  });

  if (!current) throw new Error("Could not determine current CFB week");

  return { week: current.week, year };
}

/* ============================
   FETCH ONE DIVISION
============================ */
async function getDivisionGames(year, week, division) {
  const url = `${CFBD_BASE}/games?year=${year}&week=${week}&division=${division}`;

  const res = await fetch(url, {
    headers: { "Authorization": `Bearer ${API_KEY}` }
  });

  if (!res.ok) return [];

  const games = await res.json();

  return games.map(g => ({
    division,
    home: g.home_team,
    away: g.away_team,
    time: g.start_date,
    tv: g.tv || "",
    status: g.status || "scheduled",
  }));
}

/* ============================
   RENDER TABLE
============================ */
function renderGames(games) {
  const tbody = document.getElementById("scheduleBody");
  tbody.innerHTML = "";

  if (!games.length) {
    tbody.innerHTML = `<tr><td colspan="5">No games found.</td></tr>`;
    return;
  }

  games.sort((a, b) => (a.time || "").localeCompare(b.time || ""));

  for (const g of games) {
    const tr = document.createElement("tr");

    const timeStr = g.time ? new Date(g.time).toLocaleTimeString([], {
      hour: "numeric",
      minute: "2-digit"
    }) : "";

    function divName(d) {
      return { fbs: "FBS", fcs: "FCS", d2: "DII", d3: "DIII" }[d] || d.toUpperCase();
    }

    function statusClass(s) {
      const st = s.toLowerCase();
      if (st.includes("final")) return "status-final";
      if (st.includes("in") || st.includes("live")) return "status-live";
      return "status-scheduled";
    }

    tr.innerHTML = `
      <td>${timeStr}</td>
      <td><span class="division-pill">${divName(g.division)}</span></td>
      <td>${g.away} @ ${g.home}</td>
      <td>${g.tv}</td>
      <td class="${statusClass(g.status)}">${g.status}</td>
    `;

    tbody.appendChild(tr);
  }
}

/* ============================
   MAIN LOADER
============================ */
async function loadSchedule() {
  const status = document.getElementById("status");
  status.textContent = "Detecting current week…";

  try {
    const { year, week } = await getCurrentWeek();

    status.textContent = `Loading Week ${week}, ${year}…`;

    const divisions = ["fbs", "fcs", "d2", "d3"];

    const results = await Promise.all(
      divisions.map(d => getDivisionGames(year, week, d))
    );

    const allGames = results.flat();

    status.textContent = `Loaded ${allGames.length} games for Week ${week}`;

    renderGames(allGames);

  } catch (err) {
    console.error(err);
    status.textContent = "Error loading schedule.";
  }
}

loadSchedule();
</script>

</body>
</html>
