<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Drixy College Football</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, sans-serif;
    background: #1e1e1e;
    color: #ffffff;
  }

  /* ===== NDSU PRIDE STRIPE ===== */
  .header {
    background: #004F23;
    padding: 1.5rem 1rem 1rem;
    text-align: center;
    font-size: 1.9rem;
    font-weight: 800;
    border-bottom: 10px solid #FFC72A;
  }

  /* Light greys */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }

  thead {
    background: #303030;
  }

  th {
    padding: 0.75rem;
    color: #FFC72A;
    font-size: 0.95rem;
  }

  tr:nth-child(even) {
    background: #2b2b2b;
  }

  tr:nth-child(odd) {
    background: #242424;
  }

  td {
    padding: 0.65rem;
    font-size: 0.9rem;
  }

  /* Team logos */
  .team {
    display: flex;
    align-items: center;
    gap: 0.45rem;
  }
  .team img {
    width: 28px;
    height: 28px;
    border-radius: 4px;
  }

  .rank {
    color: #FFC72A;
    margin-right: 4px;
    font-weight: bold;
  }

  .filters {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
  }

  .filters label {
    background: #303030;
    padding: 0.4rem 0.7rem;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .week-nav {
    display: flex;
    justify-content: center;
    margin: 1rem auto;
    gap: 1rem;
  }

  .week-btn {
    background: #FFC72A;
    border: none;
    padding: 0.5rem 1rem;
    font-weight: 700;
    border-radius: 6px;
    cursor: pointer;
  }

  .division-pill {
    background: #FFC72A;
    color: #000;
    font-weight: 700;
    border-radius: 8px;
    padding: 0.1rem 0.4rem;
  }

</style>
</head>

<body>
<div class="header">College Football – Full Week</div>

<div class="filters">
  <label><input type="checkbox" class="divCheck" value="fbs" checked />FBS</label>
  <label><input type="checkbox" class="divCheck" value="fcs" checked />FCS</label>
  <label><input type="checkbox" class="divCheck" value="d2" checked />D2</label>
  <label><input type="checkbox" class="divCheck" value="d3" checked />D3</label>
</div>

<div class="week-nav">
  <button id="prevWeek" class="week-btn">← Previous Week</button>
  <div id="weekLabel" style="font-weight:700;font-size:1.1rem;"></div>
  <button id="nextWeek" class="week-btn">Next Week →</button>
</div>

<div id="status" style="text-align:center;margin:1rem 0;color:#ccc;">Loading…</div>

<table>
<thead>
  <tr>
    <th>Time</th>
    <th>Div</th>
    <th>Matchup</th>
    <th>TV</th>
  </tr>
</thead>
<tbody id="gamesTable"></tbody>
</table>

<script>
let currentYear = new Date().getFullYear();
let currentWeek = null;
let allData = null;

async function detectCurrentWeek() {
  // ESPN weeks follow CFBD's mapping; use CFBD’s calendar
  const res = await fetch(`https://api.collegefootballdata.com/calendar?year=${currentYear}`);
  const weeks = await res.json();
  const today = new Date();

  const w = weeks.find(w => {
    return today >= new Date(w.startDate) && today <= new Date(w.endDate);
  });

  currentWeek = w ? w.week : 1;
}

async function loadSchedule() {
  document.getElementById("status").textContent =
    `Loading schedule for Week ${currentWeek}…`;

  const url = `/api/schedule?year=${currentYear}&week=${currentWeek}`;
  const data = await fetch(url).then(r => r.json());
  allData = data;

  document.getElementById("weekLabel").textContent =
    `Week ${currentWeek} (${currentYear})`;

  renderTable();
}

function renderTable() {
  if (!allData) return;

  const selected = Array.from(document.querySelectorAll(".divCheck:checked"))
    .map(cb => cb.value);

  const rows = [];
  for (const div of selected) {
    for (const g of allData.divisions[div]) {
      rows.push(g);
    }
  }

  const tbody = document.getElementById("gamesTable");
  tbody.innerHTML = "";

  rows.forEach(g => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${g.time || ""}</td>
      <td><span class="division-pill">${g.division.toUpperCase()}</span></td>
      <td>
        <div class="team">
          ${g.away.logo ? `<img src="${g.away.logo}" />` : ""}
          <span class="rank">${g.away.rank || ""}</span>
          ${g.away.team}
        </div>
        @
        <div class="team">
          ${g.home.logo ? `<img src="${g.home.logo}" />` : ""}
          <span class="rank">${g.home.rank || ""}</span>
          ${g.home.team}
        </div>
      </td>
      <td>${g.tv}</td>
    `;

    tbody.appendChild(tr);
  });

  document.getElementById("status").textContent =
    `Loaded ${rows.length} games.`;
}

document.querySelectorAll(".divCheck").forEach(cb => {
  cb.addEventListener("change", renderTable);
});

document.getElementById("prevWeek").onclick = () => {
  currentWeek = Math.max(1, currentWeek - 1);
  loadSchedule();
};
document.getElementById("nextWeek").onclick = () => {
  currentWeek++;
  loadSchedule();
};

(async function init() {
  await detectCurrentWeek();
  await loadSchedule();
})();
</script>

</body>
</html>
