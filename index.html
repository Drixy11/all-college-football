<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>College Football – This Week</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, Arial, sans-serif;
      background: #f4f4f4;
      color: #111;
      text-align: center;
    }

    h1 {
      margin: 20px 0 5px;
      font-size: 28px;
    }

    #subtitle {
      margin: 0 0 15px;
      font-size: 16px;
      color: #555;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 40px;
    }

    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid #ddd;
      font-size: 14px;
    }

    th {
      background: #e0e0e0;
      font-weight: bold;
    }

    tr.day-header td {
      background: #ccc;
      font-weight: bold;
      text-align: left;
      padding-top: 12px;
      padding-bottom: 8px;
      font-size: 16px;
    }

    @media (min-width: 700px) {
      th, td {
        font-size: 15px;
        padding: 10px 8px;
      }
    }
  </style>
</head>
<body>

<h1>College Football – This Week</h1>
<div id="subtitle">Loading…</div>

<table>
  <thead>
    <tr>
      <th style="width: 16%;">Time</th>
      <th style="width: 12%;">Div</th>
      <th style="width: 44%;">Matchup</th>
      <th style="width: 28%;">TV / Result</th>
    </tr>
  </thead>
  <tbody id="games-body">
  </tbody>
</table>

<script>
  // Roughly estimate current CFB week based on late August as Week 1
  function getCurrentCfbWeek() {
    const today = new Date();
    const year = today.getFullYear();
    // Reference: Aug 25 of current year
    const ref = new Date(year, 7, 25);
    const diffDays = Math.floor((today - ref) / (1000 * 60 * 60 * 24));
    const week = Math.max(1, Math.floor(diffDays / 7) + 1);
    return { year, week };
  }

  async function loadGames() {
    const { year, week } = getCurrentCfbWeek();
    const subtitle = document.getElementById("subtitle");
    const tbody = document.getElementById("games-body");

    subtitle.textContent = `Loading games for Week ${week}, ${year}…`;
    tbody.innerHTML = "";

    try {
      const resp = await fetch(`/api/schedule?year=${year}&week=${week}`);
      if (!resp.ok) {
        subtitle.textContent = "Error loading schedule.";
        return;
      }
      const data = await resp.json();
      const games = Array.isArray(data.games) ? data.games : [];

      if (games.length === 0) {
        subtitle.textContent = `No games found for Week ${week}, ${year}.`;
        return;
      }

      subtitle.textContent = `Showing ${games.length} games for Week ${data.week}, ${data.year}.`;

      let currentDay = null;
      for (const g of games) {
        const day = g.day || "";
        if (day !== currentDay) {
          currentDay = day;
          const dayRow = document.createElement("tr");
          dayRow.className = "day-header";
          const cell = document.createElement("td");
          cell.colSpan = 4;
          cell.textContent = day || "Day";
          dayRow.appendChild(cell);
          tbody.appendChild(dayRow);
        }

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${g.time || ""}</td>
          <td>${g.division || ""}</td>
          <td>${g.matchup || ""}</td>
          <td>${g.tvOrResult || ""}</td>
        `;
        tbody.appendChild(row);
      }
    } catch (err) {
      console.error(err);
      subtitle.textContent = "Error loading schedule.";
    }
  }

  loadGames();
</script>

</body>
</html>
